<transformation>
  <info>
    <name>PL_Opoqa.Client_Main</name>
    <description/>
    <extended_description/>
    <trans_version/>
    <trans_type>Normal</trans_type>
    <trans_status>0</trans_status>
    <directory>&#x2f;</directory>
    <parameters>
    </parameters>
    <log>
      <trans-log-table>
        <connection/>
        <schema/>
        <table/>
        <size_limit_lines/>
        <interval/>
        <timeout_days/>
        <field>
          <id>ID_BATCH</id>
          <enabled>Y</enabled>
          <name>ID_BATCH</name>
        </field>
        <field>
          <id>CHANNEL_ID</id>
          <enabled>Y</enabled>
          <name>CHANNEL_ID</name>
        </field>
        <field>
          <id>TRANSNAME</id>
          <enabled>Y</enabled>
          <name>TRANSNAME</name>
        </field>
        <field>
          <id>STATUS</id>
          <enabled>Y</enabled>
          <name>STATUS</name>
        </field>
        <field>
          <id>LINES_READ</id>
          <enabled>Y</enabled>
          <name>LINES_READ</name>
          <subject/>
        </field>
        <field>
          <id>LINES_WRITTEN</id>
          <enabled>Y</enabled>
          <name>LINES_WRITTEN</name>
          <subject/>
        </field>
        <field>
          <id>LINES_UPDATED</id>
          <enabled>Y</enabled>
          <name>LINES_UPDATED</name>
          <subject/>
        </field>
        <field>
          <id>LINES_INPUT</id>
          <enabled>Y</enabled>
          <name>LINES_INPUT</name>
          <subject/>
        </field>
        <field>
          <id>LINES_OUTPUT</id>
          <enabled>Y</enabled>
          <name>LINES_OUTPUT</name>
          <subject/>
        </field>
        <field>
          <id>LINES_REJECTED</id>
          <enabled>Y</enabled>
          <name>LINES_REJECTED</name>
          <subject/>
        </field>
        <field>
          <id>ERRORS</id>
          <enabled>Y</enabled>
          <name>ERRORS</name>
        </field>
        <field>
          <id>STARTDATE</id>
          <enabled>Y</enabled>
          <name>STARTDATE</name>
        </field>
        <field>
          <id>ENDDATE</id>
          <enabled>Y</enabled>
          <name>ENDDATE</name>
        </field>
        <field>
          <id>LOGDATE</id>
          <enabled>Y</enabled>
          <name>LOGDATE</name>
        </field>
        <field>
          <id>DEPDATE</id>
          <enabled>Y</enabled>
          <name>DEPDATE</name>
        </field>
        <field>
          <id>REPLAYDATE</id>
          <enabled>Y</enabled>
          <name>REPLAYDATE</name>
        </field>
        <field>
          <id>LOG_FIELD</id>
          <enabled>Y</enabled>
          <name>LOG_FIELD</name>
        </field>
        <field>
          <id>EXECUTING_SERVER</id>
          <enabled>N</enabled>
          <name>EXECUTING_SERVER</name>
        </field>
        <field>
          <id>EXECUTING_USER</id>
          <enabled>N</enabled>
          <name>EXECUTING_USER</name>
        </field>
        <field>
          <id>CLIENT</id>
          <enabled>N</enabled>
          <name>CLIENT</name>
        </field>
      </trans-log-table>
      <perf-log-table>
        <connection/>
        <schema/>
        <table/>
        <interval/>
        <timeout_days/>
        <field>
          <id>ID_BATCH</id>
          <enabled>Y</enabled>
          <name>ID_BATCH</name>
        </field>
        <field>
          <id>SEQ_NR</id>
          <enabled>Y</enabled>
          <name>SEQ_NR</name>
        </field>
        <field>
          <id>LOGDATE</id>
          <enabled>Y</enabled>
          <name>LOGDATE</name>
        </field>
        <field>
          <id>TRANSNAME</id>
          <enabled>Y</enabled>
          <name>TRANSNAME</name>
        </field>
        <field>
          <id>STEPNAME</id>
          <enabled>Y</enabled>
          <name>STEPNAME</name>
        </field>
        <field>
          <id>STEP_COPY</id>
          <enabled>Y</enabled>
          <name>STEP_COPY</name>
        </field>
        <field>
          <id>LINES_READ</id>
          <enabled>Y</enabled>
          <name>LINES_READ</name>
        </field>
        <field>
          <id>LINES_WRITTEN</id>
          <enabled>Y</enabled>
          <name>LINES_WRITTEN</name>
        </field>
        <field>
          <id>LINES_UPDATED</id>
          <enabled>Y</enabled>
          <name>LINES_UPDATED</name>
        </field>
        <field>
          <id>LINES_INPUT</id>
          <enabled>Y</enabled>
          <name>LINES_INPUT</name>
        </field>
        <field>
          <id>LINES_OUTPUT</id>
          <enabled>Y</enabled>
          <name>LINES_OUTPUT</name>
        </field>
        <field>
          <id>LINES_REJECTED</id>
          <enabled>Y</enabled>
          <name>LINES_REJECTED</name>
        </field>
        <field>
          <id>ERRORS</id>
          <enabled>Y</enabled>
          <name>ERRORS</name>
        </field>
        <field>
          <id>INPUT_BUFFER_ROWS</id>
          <enabled>Y</enabled>
          <name>INPUT_BUFFER_ROWS</name>
        </field>
        <field>
          <id>OUTPUT_BUFFER_ROWS</id>
          <enabled>Y</enabled>
          <name>OUTPUT_BUFFER_ROWS</name>
        </field>
      </perf-log-table>
      <channel-log-table>
        <connection/>
        <schema/>
        <table/>
        <timeout_days/>
        <field>
          <id>ID_BATCH</id>
          <enabled>Y</enabled>
          <name>ID_BATCH</name>
        </field>
        <field>
          <id>CHANNEL_ID</id>
          <enabled>Y</enabled>
          <name>CHANNEL_ID</name>
        </field>
        <field>
          <id>LOG_DATE</id>
          <enabled>Y</enabled>
          <name>LOG_DATE</name>
        </field>
        <field>
          <id>LOGGING_OBJECT_TYPE</id>
          <enabled>Y</enabled>
          <name>LOGGING_OBJECT_TYPE</name>
        </field>
        <field>
          <id>OBJECT_NAME</id>
          <enabled>Y</enabled>
          <name>OBJECT_NAME</name>
        </field>
        <field>
          <id>OBJECT_COPY</id>
          <enabled>Y</enabled>
          <name>OBJECT_COPY</name>
        </field>
        <field>
          <id>REPOSITORY_DIRECTORY</id>
          <enabled>Y</enabled>
          <name>REPOSITORY_DIRECTORY</name>
        </field>
        <field>
          <id>FILENAME</id>
          <enabled>Y</enabled>
          <name>FILENAME</name>
        </field>
        <field>
          <id>OBJECT_ID</id>
          <enabled>Y</enabled>
          <name>OBJECT_ID</name>
        </field>
        <field>
          <id>OBJECT_REVISION</id>
          <enabled>Y</enabled>
          <name>OBJECT_REVISION</name>
        </field>
        <field>
          <id>PARENT_CHANNEL_ID</id>
          <enabled>Y</enabled>
          <name>PARENT_CHANNEL_ID</name>
        </field>
        <field>
          <id>ROOT_CHANNEL_ID</id>
          <enabled>Y</enabled>
          <name>ROOT_CHANNEL_ID</name>
        </field>
      </channel-log-table>
      <step-log-table>
        <connection/>
        <schema/>
        <table/>
        <timeout_days/>
        <field>
          <id>ID_BATCH</id>
          <enabled>Y</enabled>
          <name>ID_BATCH</name>
        </field>
        <field>
          <id>CHANNEL_ID</id>
          <enabled>Y</enabled>
          <name>CHANNEL_ID</name>
        </field>
        <field>
          <id>LOG_DATE</id>
          <enabled>Y</enabled>
          <name>LOG_DATE</name>
        </field>
        <field>
          <id>TRANSNAME</id>
          <enabled>Y</enabled>
          <name>TRANSNAME</name>
        </field>
        <field>
          <id>STEPNAME</id>
          <enabled>Y</enabled>
          <name>STEPNAME</name>
        </field>
        <field>
          <id>STEP_COPY</id>
          <enabled>Y</enabled>
          <name>STEP_COPY</name>
        </field>
        <field>
          <id>LINES_READ</id>
          <enabled>Y</enabled>
          <name>LINES_READ</name>
        </field>
        <field>
          <id>LINES_WRITTEN</id>
          <enabled>Y</enabled>
          <name>LINES_WRITTEN</name>
        </field>
        <field>
          <id>LINES_UPDATED</id>
          <enabled>Y</enabled>
          <name>LINES_UPDATED</name>
        </field>
        <field>
          <id>LINES_INPUT</id>
          <enabled>Y</enabled>
          <name>LINES_INPUT</name>
        </field>
        <field>
          <id>LINES_OUTPUT</id>
          <enabled>Y</enabled>
          <name>LINES_OUTPUT</name>
        </field>
        <field>
          <id>LINES_REJECTED</id>
          <enabled>Y</enabled>
          <name>LINES_REJECTED</name>
        </field>
        <field>
          <id>ERRORS</id>
          <enabled>Y</enabled>
          <name>ERRORS</name>
        </field>
        <field>
          <id>LOG_FIELD</id>
          <enabled>N</enabled>
          <name>LOG_FIELD</name>
        </field>
      </step-log-table>
      <metrics-log-table>
        <connection/>
        <schema/>
        <table/>
        <timeout_days/>
        <field>
          <id>ID_BATCH</id>
          <enabled>Y</enabled>
          <name>ID_BATCH</name>
        </field>
        <field>
          <id>CHANNEL_ID</id>
          <enabled>Y</enabled>
          <name>CHANNEL_ID</name>
        </field>
        <field>
          <id>LOG_DATE</id>
          <enabled>Y</enabled>
          <name>LOG_DATE</name>
        </field>
        <field>
          <id>METRICS_DATE</id>
          <enabled>Y</enabled>
          <name>METRICS_DATE</name>
        </field>
        <field>
          <id>METRICS_CODE</id>
          <enabled>Y</enabled>
          <name>METRICS_CODE</name>
        </field>
        <field>
          <id>METRICS_DESCRIPTION</id>
          <enabled>Y</enabled>
          <name>METRICS_DESCRIPTION</name>
        </field>
        <field>
          <id>METRICS_SUBJECT</id>
          <enabled>Y</enabled>
          <name>METRICS_SUBJECT</name>
        </field>
        <field>
          <id>METRICS_TYPE</id>
          <enabled>Y</enabled>
          <name>METRICS_TYPE</name>
        </field>
        <field>
          <id>METRICS_VALUE</id>
          <enabled>Y</enabled>
          <name>METRICS_VALUE</name>
        </field>
      </metrics-log-table>
    </log>
    <maxdate>
      <connection/>
      <table/>
      <field/>
      <offset>0.0</offset>
      <maxdiff>0.0</maxdiff>
    </maxdate>
    <size_rowset>10000</size_rowset>
    <sleep_time_empty>50</sleep_time_empty>
    <sleep_time_full>50</sleep_time_full>
    <unique_connections>N</unique_connections>
    <feedback_shown>Y</feedback_shown>
    <feedback_size>50000</feedback_size>
    <using_thread_priorities>Y</using_thread_priorities>
    <shared_objects_file/>
    <capture_step_performance>N</capture_step_performance>
    <step_performance_capturing_delay>1000</step_performance_capturing_delay>
    <step_performance_capturing_size_limit>100</step_performance_capturing_size_limit>
    <dependencies>
    </dependencies>
    <partitionschemas>
    </partitionschemas>
    <slaveservers>
      <slaveserver>
        <name>Pentaho Carte</name>
        <hostname>http&#x3a;&#x2f;&#x2f;10.10.99.8</hostname>
        <port>8080</port>
        <webAppName>Carte</webAppName>
        <username>jurisrr</username>
<password>Encrypted 6acaecdff24588c3d4e548fe3e87cbe182</password>        <proxy_hostname/>
        <proxy_port/>
        <non_proxy_hosts/>
        <master>N</master>
        <sslMode>N</sslMode>      </slaveserver>
    </slaveservers>
    <clusterschemas>
    </clusterschemas>
    <created_user>-</created_user>
    <created_date>2017&#x2f;09&#x2f;11 13&#x3a;02&#x3a;13.385</created_date>
    <modified_user>-</modified_user>
    <modified_date>2018&#x2f;05&#x2f;16 15&#x3a;39&#x3a;05.215</modified_date>
    <key_for_session_key>H4sIAAAAAAAAAAMAAAAAAAAAAAA&#x3d;</key_for_session_key>
    <is_key_private>N</is_key_private>
  </info>
  <notepads>
  </notepads>
  <connection>
    <name>PL REPORTING_Opoqa</name>
    <server>10.10.99.8</server>
    <type>POSTGRESQL</type>
    <access>Native</access>
    <database>opoqa</database>
    <port>5432</port>
    <username>maciej</username>
    <password>Encrypted 2be98afc86aa7f2aebe0f877adf81a78f</password>
    <servername/>
    <data_tablespace/>
    <index_tablespace/>
    <attributes>
      <attribute><code>FORCE_IDENTIFIERS_TO_LOWERCASE</code><attribute>N</attribute></attribute>
      <attribute><code>FORCE_IDENTIFIERS_TO_UPPERCASE</code><attribute>N</attribute></attribute>
      <attribute><code>IS_CLUSTERED</code><attribute>N</attribute></attribute>
      <attribute><code>PORT_NUMBER</code><attribute>5432</attribute></attribute>
      <attribute><code>PRESERVE_RESERVED_WORD_CASE</code><attribute>Y</attribute></attribute>
      <attribute><code>QUOTE_ALL_FIELDS</code><attribute>N</attribute></attribute>
      <attribute><code>SUPPORTS_BOOLEAN_DATA_TYPE</code><attribute>Y</attribute></attribute>
      <attribute><code>SUPPORTS_TIMESTAMP_DATA_TYPE</code><attribute>Y</attribute></attribute>
      <attribute><code>USE_POOLING</code><attribute>N</attribute></attribute>
    </attributes>
  </connection>
  <connection>
    <name>PL_Opoqa</name>
    <server>35.195.123.73</server>
    <type>POSTGRESQL</type>
    <access>Native</access>
    <database>opoqa_prod</database>
    <port>5432</port>
    <username>maciej</username>
    <password>Encrypted 75686f51686f516b4770746759713060c4aae29d5de9be89ff0c805aee879edd</password>
    <servername/>
    <data_tablespace/>
    <index_tablespace/>
    <attributes>
      <attribute><code>FORCE_IDENTIFIERS_TO_LOWERCASE</code><attribute>N</attribute></attribute>
      <attribute><code>FORCE_IDENTIFIERS_TO_UPPERCASE</code><attribute>N</attribute></attribute>
      <attribute><code>IS_CLUSTERED</code><attribute>N</attribute></attribute>
      <attribute><code>PORT_NUMBER</code><attribute>5432</attribute></attribute>
      <attribute><code>PRESERVE_RESERVED_WORD_CASE</code><attribute>Y</attribute></attribute>
      <attribute><code>QUOTE_ALL_FIELDS</code><attribute>N</attribute></attribute>
      <attribute><code>SUPPORTS_BOOLEAN_DATA_TYPE</code><attribute>Y</attribute></attribute>
      <attribute><code>SUPPORTS_TIMESTAMP_DATA_TYPE</code><attribute>Y</attribute></attribute>
      <attribute><code>USE_POOLING</code><attribute>N</attribute></attribute>
    </attributes>
  </connection>
  <connection>
    <name>WHS</name>
    <server>10.10.99.11</server>
    <type>POSTGRESQL</type>
    <access>Native</access>
    <database>tanikredyt</database>
    <port>5432</port>
    <username>maciej</username>
    <password>Encrypted 2be98afc86aa7a190be448b63cac6a2db</password>
    <servername/>
    <data_tablespace/>
    <index_tablespace/>
    <attributes>
      <attribute><code>FORCE_IDENTIFIERS_TO_LOWERCASE</code><attribute>N</attribute></attribute>
      <attribute><code>FORCE_IDENTIFIERS_TO_UPPERCASE</code><attribute>N</attribute></attribute>
      <attribute><code>IS_CLUSTERED</code><attribute>N</attribute></attribute>
      <attribute><code>PORT_NUMBER</code><attribute>5432</attribute></attribute>
      <attribute><code>PRESERVE_RESERVED_WORD_CASE</code><attribute>Y</attribute></attribute>
      <attribute><code>QUOTE_ALL_FIELDS</code><attribute>N</attribute></attribute>
      <attribute><code>SUPPORTS_BOOLEAN_DATA_TYPE</code><attribute>Y</attribute></attribute>
      <attribute><code>SUPPORTS_TIMESTAMP_DATA_TYPE</code><attribute>Y</attribute></attribute>
      <attribute><code>USE_POOLING</code><attribute>N</attribute></attribute>
    </attributes>
  </connection>
  <order>
    <hop>
      <from>TK IDS</from>
      <to>nin sort tk</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>merge on nin</from>
      <to>Filter rows</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>nin sort tk</from>
      <to>merge on nin</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>nin sort</from>
      <to>merge on nin</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Filter rows</from>
      <to>Dummy &#x28;do nothing&#x29;</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>extract client info from slave</from>
      <to>nin sort</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Filter rows</from>
      <to>push to client_main table</to>
      <enabled>Y</enabled>
    </hop>
  </order>
  <step>
    <name>Dummy &#x28;do nothing&#x29;</name>
    <type>Dummy</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>819</xloc>
      <yloc>356</yloc>
      <draw>Y</draw>
    </GUI>
    </step>

  <step>
    <name>Filter rows</name>
    <type>FilterRows</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
<send_true_to>Dummy &#x28;do nothing&#x29;</send_true_to>
<send_false_to>push to client_main table</send_false_to>
    <compare>
<condition>
 <negated>N</negated>
 <leftvalue>opoka_id_slave</leftvalue>
 <function>IS NULL</function>
 <rightvalue/>
 </condition>
    </compare>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>819</xloc>
      <yloc>436</yloc>
      <draw>Y</draw>
    </GUI>
    </step>

  <step>
    <name>TK IDS</name>
    <type>TableInput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>WHS</connection>
    <sql>select tk_client_id as tk_client_id_1, op_client_id from tk_op_mapping</sql>
    <limit>0</limit>
    <lookup/>
    <execute_each_row>N</execute_each_row>
    <variables_active>N</variables_active>
    <lazy_conversion_active>N</lazy_conversion_active>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>384</xloc>
      <yloc>496</yloc>
      <draw>Y</draw>
    </GUI>
    </step>

  <step>
    <name>extract client info from slave</name>
    <type>TableInput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>PL_Opoqa</connection>
    <sql>select --count&#x28; id&#x29; from crm.client&#xa;&#xa;c.id as opoka_id_slave&#xa;, c.created_at as created_date&#xa;, cl.identification_datetime&#xa;, case when cl.identification_datetime is null then &#x27;0&#x27; ELSE &#x27;1&#x27; END AS identification_status&#xa;, max_up.max_id last_workflow_completed&#xa;, max_up.name as last_workflow_name&#xa;,case when apps.apps is null then ca.monthly_income else moin.monthly_income end as monthly_income&#xa;,case when apps.apps is null then ca.monthly_liabilities else moli.monthly_liabilities end as monthly_liabilities&#xa;,ca.employment&#xa;,ca.desired_amount&#xa;,pi.nin as pesel&#xa;,SUM_SCRAPING_COMPLETED&#xa;,SUM_SCRAPING_FAILED&#xa;,first_landing_new.lp_id as first_landing_page&#xa;,opoqa_loan_count as opoqa_loan_count&#xa;,opoqa_del_count as opoqa_loan_delayed&#xa;,opoqa_act_count as opoqa_loan_active&#xa;,&#x28;&#x28;&#x28;cch.response&#x3a;&#x3a;json-&#x3e;&#x3e;&#x27;viewInfo&#x27;&#x29;&#x3a;&#x3a;json-&#x3e;&#x3e;&#x27;values&#x27;&#x29;&#x3a;&#x3a;json-&#x3e;&#x3e;&#x27;loan_cnt&#x27;&#x29;&#x3a;&#x3a;int as tk_loan_count&#xa;, case when &#x28;&#x28;cch.response&#x3a;&#x3a;json-&#x3e;&#x3e;&#x27;loanInfo&#x27;&#x29;&#x3a;&#x3a;json-&#x3e;&#x3e;&#x27;activeDebtCase&#x27;&#x29; &#x3d;&#x27;true&#x27; then 1 else null end as tk_loan_delayed&#xa;,&#x28;&#x28;&#x28;cch.response&#x3a;&#x3a;json-&#x3e;&#x3e;&#x27;viewInfo&#x27;&#x29;&#x3a;&#x3a;json-&#x3e;&#x3e;&#x27;values&#x27;&#x29;&#x3a;&#x3a;json-&#x3e;&#x3e;&#x27;act_loan_cnt&#x27;&#x29;&#x3a;&#x3a;int as tk_loan_active&#xd;&#xa;&#xd;&#xa;,coalesce&#x28;lla.app_cnt,0&#x29; as application_count&#xd;&#xa;&#xd;&#xa;,wa.completed_at&#x3a;&#x3a;date as last_activity_date&#xd;&#xa;,wa.name as last_completed_activity&#xd;&#xa;,wa.resolution as last_activity_resolution&#xd;&#xa;--,wa.resolution_detail&#xd;&#xa;,wa.actor as last_activity_actor&#xa;&#xa;from crm.client c&#xa;left join &#x28;select client_id, ca.json_value&#x3a;&#x3a;json-&#x3e;&#x3e;&#x27;employmentStatus&#x27; as employment&#xa;,ca.json_value&#x3a;&#x3a;json-&#x3e;&#x3e;&#x27;monthlyIncome&#x27; as monthly_income&#xa;,ca.json_value&#x3a;&#x3a;json-&#x3e;&#x3e;&#x27;monthlyLiabilities&#x27; as monthly_liabilities&#xa;,ca.json_value&#x3a;&#x3a;json-&#x3e;&#x3e;&#x27;desiredAmount&#x27; as desired_amount&#xa; from crm.client_attribute ca&#xa;where key&#x3d;&#x27;registrationData&#x27;&#x29;ca&#xa;on ca.client_id&#x3d;c.id&#xa;left join &#x28;select client_id, max &#x28;id&#x29; as max_id from lending.loan_application group by client_id&#x29; max_app on max_app. client_id&#x3d;c.id&#xa;left join &#x28;select application_id, value as monthly_liabilities from lending.loan_application_attribute where key &#x3d;&#x27;monthlyLiabilities&#x27;&#x29;moli on moli.application_id&#x3d;max_app.max_id&#xa;left join &#x28;select application_id, value as monthly_income from lending.loan_application_attribute where key &#x3d;&#x27;monthlyIncome&#x27;&#x29;moin on moin.application_id&#x3d;max_app.max_id&#xa;left join &#x28;select client_id, min&#x28;created_at&#x29; as identification_datetime from lending.credit_limit group by client_id&#x29;cl on cl.client_id&#x3d;c.id&#xa;left join &#x28;select client_id, count &#x28;id&#x29; as apps from lending.loan_application group by client_id&#x29;apps on apps.client_id&#x3d;c.id&#xa;left join &#x28;select count&#x28;id&#x29; as SUM_SCRAPING_COMPLETED , client_id from kontox.request_log where type &#x3d; &#x27;BANK_SCRAPING&#x27; and status&#x3d;&#x27;COMPLETED&#x27; group by client_id&#x29;kontox_completed on kontox_completed.client_id&#x3d;c.id&#xa;left join &#x28;select count&#x28;id&#x29; as SUM_SCRAPING_FAILED , client_id from kontox.request_log where type &#x3d; &#x27;BANK_SCRAPING&#x27; and status&#x3d;&#x27;FAILED&#x27; group by client_id&#x29;kontox_failed on kontox_failed.client_id&#x3d;c.id&#xa;left join &#x28;select max_up.client_id, max_up.max_id, ww.name&#xa;&#xa;from workflow.workflow ww &#xa;left join&#xa; &#x28;select client_id, MAX&#x28;id&#x29; AS MAX_id&#xa;from workflow.workflow where status&#x3d; &#x27;COMPLETED&#x27;&#xa;group by client_id&#x29;max_up on max_up.max_id&#x3d;ww.id&#x29;max_up on max_up.client_id&#x3d;c.id&#xa;left join crm.personal_info pi on c.id&#x3d;pi.client_id&#xa;--first landing page&#xa;left join &#x28;select fln.id as id, fln.min_id,fln1.lp_id as lp_id from &#xa;&#xa;&#x28;&#x28;select la.client_id as id, min&#x28;ma_ev.id&#x29;as min_id from lending.loan_application la&#xa;&#xa;left join marketing_landing.event ma_ev on la.id&#x3d;ma_ev.application_id group by la.client_id&#x29;fln &#xa;&#xa;left join &#x28;select  la.id as id, ma_ev.id as all_id, ma_ev.landing_page_id as lp_id from lending.loan_application la&#xa;left join marketing_landing.event ma_ev on la.id&#x3d;ma_ev.application_id&#x29;fln1&#xa; on fln.min_id&#x3d;fln1.all_id&#x29;&#xa; &#x29; first_landing_new on first_landing_new.id&#x3d;c.id&#xa; --loan count opoqa&#xa; left join &#x28;select client_id, count&#x28;id&#x29; as opoqa_loan_count from lending.loan where status &#x3c;&#x3e; &#x27;VOIDED&#x27; group by client_id&#x29;loan_cnt on loan_cnt.client_id&#x3d;c.id&#xa; --delayed count opoqa&#xa;  left join &#x28;select client_id, count&#x28;id&#x29; as opoqa_del_count from lending.loan where status &#x3d; &#x27;ACTIVE&#x27; and current_date-maturity_date&#x3a;&#x3a;date &#x3e;0 group by client_id&#x29;loan_del on loan_del.client_id&#x3d;c.id&#xa;  --active count opoqa&#xa;   left join &#x28;select client_id, count&#x28;id&#x29; as opoqa_act_count from lending.loan where status &#x3d; &#x27;ACTIVE&#x27; and current_date-maturity_date&#x3a;&#x3a;date &#x3c;&#x3d;0 group by client_id&#x29;loan_act on loan_act.client_id&#x3d;c.id&#xa;--cross check join&#xa;--,&#x28;&#x28;&#x28;cch.response&#x3a;&#x3a;json-&#x3e;&#x3e;&#x27;viewInfo&#x27;&#x29;&#x3a;&#x3a;json-&#x3e;&#x3e;&#x27;values&#x27;&#x29;&#x3a;&#x3a;json-&#x3e;&#x3e;&#x27;loan_cnt&#x27;&#x29;&#x3a;&#x3a;int as tk_loan_count&#xa;left join&#x28;select &#xa;cr_ch.client_id, cr_ch.response, cr_ch.id from poland.cross_check cr_ch inner join &#x28;select client_id, max&#x28;id&#x29; as id from poland.cross_check group by client_id&#x29;cr_max on cr_max.id&#x3d;cr_ch.id&#x29;cch on cch.client_id&#x3d;c.id&#xd;&#xa;&#xd;&#xa;left join &#x28;select client_id, count&#x28;id&#x29; as app_cnt from lending.loan_application group by 1&#x29;lla on &#x28;c.id &#x3d; lla.client_id&#x29;&#xd;&#xa;&#xd;&#xa;left join &#x28;select client_id, max&#x28;wa.id&#x29; as max_w_activity&#xd;&#xa;&#xd;&#xa;&#xd;&#xa;from workflow.workflow w join workflow.activity wa on wa.workflow_id &#x3d; w.id&#xd;&#xa;&#xd;&#xa;where wa.status &#x3d; &#x27;COMPLETED&#x27; and wa.resolution &#x21;&#x3d; &#x27;SKIP&#x27; and wa.resolution_detail &#x21;&#x3d; &#x27;Skipped&#x27;&#xd;&#xa;group by 1&#x29;waa on c.id &#x3d; waa.client_id&#xd;&#xa;&#xd;&#xa;left join workflow.activity wa on &#x28;wa.id &#x3d; waa.max_w_activity&#x29;&#xd;&#xa;&#xa;order by c.id&#xa;&#xa;</sql>
    <limit>0</limit>
    <lookup/>
    <execute_each_row>N</execute_each_row>
    <variables_active>N</variables_active>
    <lazy_conversion_active>N</lazy_conversion_active>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>384</xloc>
      <yloc>352</yloc>
      <draw>Y</draw>
    </GUI>
    </step>

  <step>
    <name>merge on nin</name>
    <type>MultiwayMergeJoin</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <join_type>FULL OUTER</join_type>
    <step0>nin sort</step0>
    <step1>nin sort tk</step1>
    <number_input>2</number_input>
    <keys>
      <key>opoka_id_slave</key>
      <key>op_client_id</key>
    </keys>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>643</xloc>
      <yloc>436</yloc>
      <draw>Y</draw>
    </GUI>
    </step>

  <step>
    <name>nin sort</name>
    <type>SortRows</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
      <directory>&#x25;&#x25;java.io.tmpdir&#x25;&#x25;</directory>
      <prefix>out</prefix>
      <sort_size>1000000</sort_size>
      <free_memory/>
      <compress>N</compress>
      <compress_variable/>
      <unique_rows>N</unique_rows>
    <fields>
      <field>
        <name>opoka_id_slave</name>
        <ascending>Y</ascending>
        <case_sensitive>N</case_sensitive>
        <collator_enabled>N</collator_enabled>
        <collator_strength>0</collator_strength>
        <presorted>N</presorted>
      </field>
    </fields>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>579</xloc>
      <yloc>356</yloc>
      <draw>Y</draw>
    </GUI>
    </step>

  <step>
    <name>nin sort tk</name>
    <type>SortRows</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
      <directory>&#x25;&#x25;java.io.tmpdir&#x25;&#x25;</directory>
      <prefix>out</prefix>
      <sort_size>1000000</sort_size>
      <free_memory/>
      <compress>N</compress>
      <compress_variable/>
      <unique_rows>N</unique_rows>
    <fields>
      <field>
        <name>op_client_id</name>
        <ascending>Y</ascending>
        <case_sensitive>N</case_sensitive>
        <collator_enabled>N</collator_enabled>
        <collator_strength>0</collator_strength>
        <presorted>N</presorted>
      </field>
    </fields>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>579</xloc>
      <yloc>500</yloc>
      <draw>Y</draw>
    </GUI>
    </step>

  <step>
    <name>push to client_main table</name>
    <type>TableOutput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>PL REPORTING_Opoqa</connection>
    <schema/>
    <table>client_main</table>
    <commit>5000</commit>
    <truncate>Y</truncate>
    <ignore_errors>N</ignore_errors>
    <use_batch>Y</use_batch>
    <specify_fields>Y</specify_fields>
    <partitioning_enabled>N</partitioning_enabled>
    <partitioning_field/>
    <partitioning_daily>N</partitioning_daily>
    <partitioning_monthly>Y</partitioning_monthly>
    <tablename_in_field>N</tablename_in_field>
    <tablename_field/>
    <tablename_in_table>Y</tablename_in_table>
    <return_keys>N</return_keys>
    <return_field/>
    <fields>
        <field>
          <column_name>opoqa_client_id</column_name>
          <stream_name>opoka_id_slave</stream_name>
        </field>
        <field>
          <column_name>tk_client_id</column_name>
          <stream_name>tk_client_id_1</stream_name>
        </field>
        <field>
          <column_name>created_date</column_name>
          <stream_name>created_date</stream_name>
        </field>
        <field>
          <column_name>identification_datetime</column_name>
          <stream_name>identification_datetime</stream_name>
        </field>
        <field>
          <column_name>identification_status</column_name>
          <stream_name>identification_status</stream_name>
        </field>
        <field>
          <column_name>last_workflow_completed</column_name>
          <stream_name>last_workflow_completed</stream_name>
        </field>
        <field>
          <column_name>monthly_income</column_name>
          <stream_name>monthly_income</stream_name>
        </field>
        <field>
          <column_name>monthly_liabilities</column_name>
          <stream_name>monthly_liabilities</stream_name>
        </field>
        <field>
          <column_name>employment</column_name>
          <stream_name>employment</stream_name>
        </field>
        <field>
          <column_name>desired_amount</column_name>
          <stream_name>desired_amount</stream_name>
        </field>
        <field>
          <column_name>last_workflow_name</column_name>
          <stream_name>last_workflow_name</stream_name>
        </field>
        <field>
          <column_name>sum_scraping_completed</column_name>
          <stream_name>sum_scraping_completed</stream_name>
        </field>
        <field>
          <column_name>sum_scraping_failed</column_name>
          <stream_name>sum_scraping_failed</stream_name>
        </field>
        <field>
          <column_name>first_landing_page</column_name>
          <stream_name>first_landing_page</stream_name>
        </field>
        <field>
          <column_name>opoqa_loan_count</column_name>
          <stream_name>opoqa_loan_count</stream_name>
        </field>
        <field>
          <column_name>opoqa_loan_delayed</column_name>
          <stream_name>opoqa_loan_delayed</stream_name>
        </field>
        <field>
          <column_name>opoqa_loan_active</column_name>
          <stream_name>opoqa_loan_active</stream_name>
        </field>
        <field>
          <column_name>tk_loan_count</column_name>
          <stream_name>tk_loan_count</stream_name>
        </field>
        <field>
          <column_name>tk_loan_delayed</column_name>
          <stream_name>tk_loan_delayed</stream_name>
        </field>
        <field>
          <column_name>tk_loan_active</column_name>
          <stream_name>tk_loan_active</stream_name>
        </field>
        <field>
          <column_name>application_count</column_name>
          <stream_name>application_count</stream_name>
        </field>
        <field>
          <column_name>last_completed_activity</column_name>
          <stream_name>last_completed_activity</stream_name>
        </field>
        <field>
          <column_name>last_activity_date</column_name>
          <stream_name>last_activity_date</stream_name>
        </field>
        <field>
          <column_name>last_activity_resolution</column_name>
          <stream_name>last_activity_resolution</stream_name>
        </field>
        <field>
          <column_name>last_activity_actor</column_name>
          <stream_name>last_activity_actor</stream_name>
        </field>
    </fields>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>1072</xloc>
      <yloc>432</yloc>
      <draw>Y</draw>
    </GUI>
    </step>

  <step_error_handling>
  </step_error_handling>
  <slave-step-copy-partition-distribution>
  </slave-step-copy-partition-distribution>
  <slave_transformation>N</slave_transformation>
</transformation>
